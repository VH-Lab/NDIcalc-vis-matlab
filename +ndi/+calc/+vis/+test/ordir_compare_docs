function [b, errormsg] = oridir_compare_docs(document_expected, document_actual, scope)
% ORIDIR_COMPARE_DOCS
%
% [B, ERRORMSG] = ndi.calc.vis.test.oridir_compare_docs(DOC_EXPECTED, DOC_ACTUAL, SCOPE)
%


b = 1;
errormsg = '';

  % start comparison

doc_e = document_expected.document_properties.orientation_direction_tuning;
doc_a = document_actual.document_properties.orientation_direction_tuning;

% Comparing Properties
% Comparing Properties.coordinates

properties_match = strcmpi(doc_e.properties.coordinates, doc_a.properties.coordinates);
if ~properties_match,
   b = 0;
   errormsg = ['Expected properties.coordinates field of ' doc_e.properties.coordinates ' but observed ' doc_a.properties.coordinates];
   return;
end;

% omparing Tuning_curves
% direction angles match  within 1e-6

diretol = 1e-6;

direction_match = vlt.data.sizeeq(doc_e.tuning_curve.direction(:),doc_a.tuning_curve.direction(:))
if direction_match,
   direction_match = max(abs(doc_e.tuning_curve.direction(:) - doc_a.tuning_curve.direction(:)) < diretol;
end;

if ~direction_match,
   b = 0;
   errormsg = ['Direction angles differed by greater than ' num2str(diretol) '.'];
end;

% mean angle match within 3

meantol = 3

mean_match = vlt.data.sizeeq(doc_e.tuning_curve.mean(:),doc_a.tuning_curve.mean(:));
if mean_match, 
   mean_match = max(abs(doc_e.tuning_curve.mean(:) - doc_a.tuning_curve.mean(:))) < meantol;
end;

if ~mean_match,
   b = 0;
   errormsg = ['Mean angles differed by greater than ' num2str(meantol) '.'];
end;

% stddev match exactly

stddev_match = vlt.data.sizeeq(doc_e.tuning_curve.stddev(:),doc_a.tuning_curve.stddev(:));
if stddev_match,
   stddev_match = 1;
end;

if ~stddev_match,
   b = 0;
   errormsg = ['Stddev are different.']
end;

% stderr match exactly

stderr_match = vlt.data.sizeeq(doc_e.tuning_curve.stderr(:),doc_a.tuning_curve.stderr(:));
if stderr_match,
   stderr_match = 1;
end;

if ~stderr_match,
   b = 0;
   errormsg = ['Stderr are different.']
end;

% Comparing Significance

properties_match = strcmpi(doc_e.properties.coordinates, doc_a.properties.coordinates);
if ~properties_match,
   b = 0;
   errormsg = ['Expected properties.coordinates field of ' doc_e.properties.coordinates ' but observed ' doc_a.properties.coordinates];
   return;
end;


